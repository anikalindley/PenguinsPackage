---
title: "Project 3: project3package Tutorial"
author: "Anika Lindley"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{project3package Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

The package `project3package` contains four functions: `my_t.test`, `my_lm`, `my_rf_cv`, and `my_knn_cv`. These functions can be used to make statistical inferences, predictions, and to assess the performance of statistical models.

## Instalation

To install `project3package` from GitGub, run the following code in your console:

```{r, eval = FALSE}
install.packages("devtools")
devtools::install_github("anikalindley/project3package", build_vignette = TRUE, build_opts = c())
```

```{r}
library(project3package)
```

# my_t.test

To demonstate the use of `my_t.test`, I will examine the mean age of life expectancy from the `my_gapminder` dataset. For all three trials, $H_{0} = 60$, and I will use `my_t.test` to determine the liklihood that the life expectancy is not 60 years, is less than 60 years, or is 

```{r, include=TRUE}
data("my_gapminder")
life_expectancy <- my_gapminder$lifeExp
```

## two sided hypothesis test

```{r}
test_two.sided <- my_t.test(x = life_expectancy, alternative = "two.sided", mu = 60)
test_two.sided
```

The p-value for the trial with $H_{a} \neq 60$ is `r test_two.sided[[4]]`, which is greater than $\alpha = 0.05$. This means that there is a `r test_two.sided[[4]]` chance that you would get a value at least this extreme, assuming $H_{0} = 60$ is correct. Therefore, we fail to reject the null hypothesis that the mean age is 60 years. 

## one sided hypothesis test where the alternative hypothesis is mu < 60
```{r}
test_less <- my_t.test(x = life_expectancy, alternative = "less", mu = 60)
test_less
```

The p-value for the trial with $H_{a} < 60$ is `r test_less[[4]]`, which is less than $\alpha = 0.05$. This means that there is a `r test_less[[4]]` chance that you would get a value at least this extreme, assuming $H_{0} = 60$ is correct. Therefore, we can reject the the null hypothesis in favor of the alternative hypothesis, that the true mean life expectancy is less than 60. 

```{r}
test_greater <- my_t.test(x = life_expectancy, alternative = "greater", mu = 60)
test_greater
```

The p-value for the trial with $H_{a} > 60$ is `r test_greater[[4]]`, which is greater than $\alpha = 0.05$. This means that there is a `r test_greater[[4]]` chance that you would get a value at least this extreme, assuming $H_{0} = 60$ is correct. Therefore, we fail to reject the null hypothesis that the mean age is 60 years. 

# my_lm

To demonstate the use of `my_lm` I will create a regression using life expectancy as my response variable and GDP per capita and continent as my explanatory variables, with data from `my_gapminder`.

```{r}
my_model <- my_lm(formula = lifeExp ~ gdpPercap + continent, data = my_gapminder)
my_model
```
The coefficient for gdpPercap is `r my_model[2,1]`, which means that for each one unit increase of gdpPercap, lifeExp increases by `r my_model[2,1]` years.

The hypothesis test for the gdpPercap coefficient is $H_{0} = 0$ and $H_{a} \neq 0$. We can use the value from the column Pr(>|t|) for the hypothesis test. The p-value, `r my_model[2, 4]` is less than $\alpha = 0.05$; therefore, we can reject the null hypotheses in favor of the alternative hypothesis, suggesting that the true change in life expectancy for each one unit increase of GDP per capita is not zero.

The following plot compared the actual vs. fitted values: 

```{r, warning = FALSE}
library(ggplot2)
my_x <- model.matrix(my_gapminder$lifeExp ~ gdpPercap + continent, data = my_gapminder)
fitted <- my_x %*% as.matrix(my_model[, 1])
my_df <- data.frame(actual = my_gapminder$lifeExp, fitted = fitted, continent = my_gapminder$continent)

ggplot(my_df, aes(x = actual, y = fitted, color = continent)) + 
  geom_point(size = 0.7) + 
  theme_bw(base_size = 12) + 
  labs(x = "Actual (years)", y = "Fitted (years)", title = "Actual vs. Fitted") + 
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlim(20, 90) + 
  ylim(20, 90)

```

# my_knn_cv

To demonstrate the use of `my_knn_cv` I will predict the class species of penguins using covariates bill length, bill depth, flipper length,and body mass and will use 5-fold cross validation to assess the predictions. 

```{r}
library(magrittr)
library(dplyr)
# remove NA values
penguin <- na.omit(my_penguins)
# select covariates
my_train <- penguin %>% dplyr::select(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g)
# true species (class) of penguins
my_cl <- penguin %>% dplyr::pull(species)

training_err <- matrix(NA, 10, 1)
CV_missclassification <- matrix(NA, 10, 1)

for(i in 1:10) {
# predict species using 1 through 10 nearest neighbors and 5-fold cross-validation
my_knn <- my_knn_cv(my_train, my_cl, i, 5)
training_err[i] <- length(which(penguin$species != my_knn[[1]])) / nrow(penguin)
CV_missclassification[i] <- my_knn[[2]]
}

training_err
CV_missclassification
```

# my_rf_cv

To demonstate the use of my_rf_cv I will predict the body mass of penguins using bill length, bill dpeth, and flipper length as covariates. 

```{r}
my_rf <- matrix(NA, 3, 30)

for (i in c(2, 5, 10)) {
  for(j in 1:30) {
       my_rf[1, j] <- my_rf_cv(i)
       my_rf[2, j] <- my_rf_cv(i)
       my_rf[3, j] <- my_rf_cv(i)
  }
}


my_rf

```

